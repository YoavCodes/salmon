<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Salmon</title>

<!-- Javascript -->
<script type="text/javascript" language="javascript" src="assets/js/jquery.js" ></script>
<script type="text/javascript" language="javascript" src="assets/js/fin.js" ></script>
<script type="text/javascript" language="javascript" src="assets/js/extras.fin.js" ></script>
<script type="text/javascript" language="javascript">

var x = function() {
    console.log('i am x');
    //this.test = function() { console.log('i am test') }
}

x.test = function() { console.log('i am test') }





// configure app
fin.init({
    navigate: { // a list of 'pages' defined as functions to run and container->templates to render
        // landing
        home: {
            before_func: [[x.test, {hi: 4}]],
            container: ['welcomed'],            
        }
    },    
    routes: { // a map of hashbang urls to navigate templates

    },
    callbacks: { // events and callbacks to extend highfin
        
    },
    default_page: 'home'
})
// todo: 
// 1. add dependency 'container' to list all required templates for that page and sub pages
// 2. refactor to hierarchy structure that supports nested pages
// 3. refactor so if main blog page has 'blog_header' template in 'header' container. other blog pages don't need to specify it
// 4. navigate function still has to work by page name. might be too complicated for a simple object. or at least process them all at runtime. simply loop over them at runtime converting this verbose structure to the original simpler structure
// 5. we don't need to explicitely list a containers object, because all containers are specified in containers{} objects. the original array should still be compiled during processing.
/*fin.init({
    
    navigate: { // a list of 'pages' defined as functions to run and container->templates to render
        // landing
        'global': {
            footer: ['_global_footer']
        },
        'home': {
            parents: ['global'], // list of parents in order of overiding
            require: [], // template's required for this page not assigned to a specific container. eg: subtemplates, 
            maincontent: ['welcome'],  
        },
        'blog': {
            parents: ['global'],
            require: ['fn_misc','blog_commenting'],
            before_func: [['fin.fn.misc.setCurrentApp', {app: 'blog'}]],
            header: ['blog_header']
        },        
        'blog_with_sidebar': {
            parents: ['blog'],  
            maincontent: ['_blog_sidebar'],// overrides maincontent container. blog_singlepost renders comments and tags as subtemplates
        },
        'blog_main_page': {
            parents: ['blog_with_sidebar'],  
            maincontent: ['blog_multiposts'],// overrides maincontent container. blog_singlepost renders comments and tags as subtemplates
        },
        'singlepost': {
            parents: ['blog_with_sidebar'],
            require: ['blog_comments', 'blog_tags'],  
            before_func: [['fin.fn.misc.otherfunction', {thing: 'one'}]], 
            maincontent: ['blog_singlepost'],// overrides maincontent container. blog_singlepost renders comments and tags as subtemplates
        },
        'singlejustpost': {   
            parents: ['blog_with_sidebar'],        
            maincontent: ['blog_singlepost'],// overrides maincontent container  template logic can check if it's the singlejustpost page when rendering and opt not to render the inline comments template.
        },

        'singlenosidebar': {        
            parents: ['blog'],
            require: ['blog_comments', 'blog_tags'],  
            maincontent: ['blog_singlepost'],// overrides maincontent container  
        }

    },   
    routes: { // a map of hashbang urls to navigate templates

    },
    callbacks: { // events and callbacks to extend highfin
        
    },
    default_page: 'home'
});*/
// the above is very hard to reason about and visualize


/*
the above will get compiled to:
navigate: { // a list of 'pages' defined as functions to run and container->templates to render
    // landing
    'home': {
        require: [], // template's required for this page not assigned to a specific container. eg: subtemplates, 
        maincontent: ['welcome'],  
        containers: {
            footer: ['_global_footer']          
        }
    },
    'blog': {
        require: ['fn_misc','blog_commenting'],
        before_func: [[fin.fn.misc.setCurrentApp], {app: 'blog'}],
        containers: {
            header: ['blog_header'],
            maincontent: ['_blog_sidebar', 'blog_mainposts'],
            footer: ['_global_footer']
        }
    },
    'singlepost': {
        require: ['fn_misc', 'blog_comments', 'blog_tags'],   
        before_func: [[fin.fn.misc.setCurrentApp], {app: 'blog'}],   
        containers: {              
            maincontent: ['_blog_sidebar', 'blog_singlepost'],// overrides maincontent container. blog_singlepost renders comments and tags as subtemplates
            footer: ['_global_footer']
        }
    },
    'singlenosidebar': {
        require: ['fn_misc', 'blog_comments', 'blog_tags'],  
        before_func: [[fin.fn.misc.setCurrentApp], {app: 'blog'}],    
        containers: {              
            maincontent: ['blog_singlepost'],// overrides maincontent container  
            footer: ['_global_footer']
        }
    },
    'singlejustpost': {   
        require: ['fn_misc'],                 
        before_func: [[fin.fn.misc.setCurrentApp], {app: 'blog'}],
        containers: {
            maincontent: ['_blog_sidebar', 'blog_singlepost'],// overrides maincontent container  
            footer: ['_global_footer']
        }
    }
},   

*/

var x = 5;

fin.data = {
    users: {
        1: {
            name: "Yoav",
            email: "hello@yoavgivati.com",
            friends: 20,
            account_type: "basic",
            id: 01
        },
        2: {
            name: "Bill",
            email: "bill@gmail.com",
            friends: 21,
            account_type: "basic",
            id: 02
        },
        3: {
            name: "Fred",
            email: "fred@gmail.com",
            friends: 19,
            account_type: "admin",
            id: 03
        },
        4: {
            name: "Jamie",
            email: "jamie@gmail.com",
            friends: 2,
            account_type: "basic",
            id: 04
        },
        5: {
            name: "Maddy",
            email: "maddy@gmail.com",
            friends: 200,
            account_type: "admin",
            id: 05
        },
        6: {
            name: "Francine",
            email: "francine@gmail.com",
            friends: 4500,
            account_type: "manager",
            id: 06
        }
    },
    posts: {        
        1: {
            title: "post 1",
            content: "blah lorum ipsum post one",
            author: "__fin.data.users.1",
            comments: [
                {
                    author: "__fin.data.users.1",
                    comment: "commented on my own post"
                },
                {
                    author: "__fin.data.users.6",
                    comment: "I'm an admin, this is a great post!"
                }
            ]
        },
        2: {
            title: "post 2",
            content: "blah lorum ipsum ipsum post two",
            author: "__fin.data.users.3",
            comments: [
                {
                    author: "__fin.data.users.4",
                    comment: "commented on my own post"
                },
                {
                    author: "__fin.data.users.6",
                    comment: "I'm an admin, this is another great post!"
                }
            ]
        },
        3: {
            title: "post 3",
            content: "blah lorum ipsum ipsum post three",
            author: "__fin.data.users.1",
            comments: [
                {
                    author: "__fin.data.users.1",
                    comment: "commented on my own post"
                },
                {
                    author: "__fin.data.users.6",
                    comment: "I'm an admin, this is a great post!"
                }
            ]
        }
    }

};

</script>



</head>
<body id="container">
    
<button class="clickme">don't click me</button>



<script type="text/template" id="template_welcomed-html">
<div>
  welcome template
</div>




<pre>
this
is
new
line
<b>
--------------
[[ var bob = fin('fin.data.posts').where('author.name').is('Yoav').or('content').contains('two').sort(); log('bob', bob) ]]
[[ for(var i=0; i<bob.length; i++) {  ]]
line 16 char 42
    <h1>{{ bob[i].title }}</h1>
    <div>{{ bob[i].content }}</div>
    <div>{{ fin('author.name', bob[i]).val }}</div>
[[ } ]]
--------------
note: todo: can only use singlequotes in inlinevar tags
</b>
</pre>

x is {{ x }} and {{ x }}

{{  }}

{{
    x
}}



Todo: fix this. in chrome tags get automatically terminated by inlinejs.. probably because we're splitting it up into document fragments and appending text. affects any open tag. rendering a template inside another template should close it's own tags. so string concat all non-subtemplates. what if we render a sub-template into a pre tag?. $.append() is creating elements, so it's "closed" once the tag becomes an element.' much more testing required. need to create a mechanism where the position of the inline_js() defines where the template is inserted to.

"fix 1. concat everything that isn't a document fragment. this will limit unwanted tag closing to subtemplates. can still use inline-js"

"The render function with print a tag with a unique id. and append the document fragment to an arrary of objects {id: 123, fragment: documentFragment}. then after tmpl is concat and appended will loop through subtmpls using $.replaceWith() to replace the matching id with the fragment. so it's rendered inline, then appending one document fragment to the rootFragment"
<pre>
--------------
[[ var x = 5 ]]
--------------
</pre>

<br />consider instead doing inline_js() before a tag then inline_vars inside?
<pre>
--------------
{{ x }}
--------------
</pre>


<pre>
--------------
[[ render(`welcomed2`, {test: `feast`}) ]]
--------------
</pre>

<h1>
--------------
[[ render(`welcomed2`, {test: `feast`}) ]]
--------------
</h1>


<br /><br />

[[ console.log('hi') ]] 
<pre>
-----

[[
for(var b=0; b<5; b++) {
    print(`<b>`)
    print(`index b: `+b+`<br />`)
    print(`</b>`)
}
]]

-----
</pre>

[[ 
exports.loginFormValidator = function(form, inputs){    
    var valid = true;

    // use the string length validator
    valid = fin.v.strlen(form, 'username', 3, 8);
    valid = fin.v.strlen(form, 'password', 3, 20);


    return valid
} 
]]
[[
var y = `hel
{{x}} 
lo`
]]

{{y}}

<form id="loginForm" ajaxform validator="fin.fn.welcomed.loginFormValidator">
    <input type="text" name="username" />
    <input type="password" name="password" />

    <input type="submit" value="Login" />
</form>

[[ addEvent('submit', '#loginForm', fin.submit) ]]
note: add ajax("#loginF corm"); function as a shortcut to add fin.submit as a submit handler

[[ console.log(addEvent) ]]

<button class="clickme">click me</button>
[[ addEvent(`click`, `.clickme`, function(){console.log(`clicked`)}) ]]

[[ print(fin.r(`welcomed2`, {test: 'toast'})) ]]

[[ render(`welcomed2`, {test: `feast`}) ]]

so 
this
is
it?
'single'
"double"

[[ for(var b=0; b<5; b++) { ]]

    {{b}}

[[ } ]]




</pre>


</script>

<script type="text/template" id="template_welcomed2-html">
<button class="reallyclickme">really click me</button>
[[ addEvent(`click`, `.reallyclickme`, function(){console.log(`really clicked`+data.test)}) ]]
</script>



</body>
</html>

